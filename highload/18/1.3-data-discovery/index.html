<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Один из вариантов реализации Data Discovery в микросервисной архитектуре &middot; Конспекты</title><link rel=stylesheet href=/conf/css/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700"><link rel=stylesheet href=/conf/custom.css><link rel=icon type=image/png sizes=32x32 href=/conf/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/conf/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/conf/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=Конспекты><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107215405-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-107215405-3');</script></head><body><nav class=nav><div class=nav-container><a href=/conf/><h2 class=nav-title>Конспекты</h2></a><ul><li><a href=/conf/>Posts</a></li></ul></div></nav><main><div class=post><div class=single__header><div class=post-info>Николай Голов, Avito</div><h1 class=post-title>Один из вариантов реализации Data Discovery в микросервисной архитектуре</h1><div class=post-line></div><div class=tag-block><span class=catalogue-tags><a href=/conf/tags/highload class=tags>Highload</a></span><span class=catalogue-tags><a href=/conf/tags/2018 class=tags>2018</a></span><span class=catalogue-tags><a href=/conf/tags/avito class=tags>Avito</a></span></div></div><p>Николай руководит Data Platform в Avito. Сотни сервисов, сотни баз.</p><p>Как это бывает сначала: shared database.
У всех сервисов есть связь между собой и через базу.
Тестировать невозможно.
Поэтому при переходе на микросервисы у каждого сервиса своя база.
Если шардов несколько, то базы надо синхронизировать.</p><p>В реальности в компании есть сразу всё: и микросервисы с отдельными базами, и макро, и монолиты с shared database.</p><p>Как начинается переписывание монолита на микросервисы? С доменного моделирования. Кто может его сделать? Никто, но есть люди, которые могут попробовать.</p><h2 id=data-discovery>Data discovery</h2><p>Чтобы ориентироваться, нужен цифровой двойник инфраструктуры — Avito Platform Digital Twin.</p><p>Задачи:</p><ul><li>В каких сервисах хранятся какие важные данные?</li><li>Как важные данные путешествуют между сервисами?</li><li>Кто может работать с какими данными? Как выдать и забрать права?</li><li>Как поднять информационно-целостный подграф микросервисного графа? В частности, как прогреть ему кэши?</li></ul><p>Решение — Persistent Fabric, «помнящая ткань».</p><p>База — это место, где сущности создаются и редактируются. Остальное — кеши.</p><p>К сущностям нужно как-то получать доступ, поэтому появляются команды, которым принадлежат сервисы. С сервисом без команды работать сложно. Конкретный человек, который много коммитил — не решение, потому что он может уволиться. Поэтому нужно хранить команды и людей за ними.</p><p><img src=../../../images/persistent-fabric.png alt></p><p>Не нужно заполнять весь граф вручную, данные можно достать во внутренних системах.</p><ul><li>Команды — 1С</li><li>Сотрудники — LDAP</li><li>Сервисы — Atlas</li><li>Storages — Storage Discovery</li><li>Entities</li><li>Service Endpoints — из мониторинга. Если что-то не мониторится, значит оно не нужно.</li><li>Метрики — тоже из мониторинга.</li></ul><h2 id=сценарий-выдача-прав>Сценарий: выдача прав</h2><p>Через граф проходим от хранилища к человеку, который подтверждает, что права можно давать.</p><p>Теперь нужно пройтись ещё раз и везде отметить вновь выданное право.</p><h2 id=сценарий-точки-использований-сущности>Сценарий: точки использований сущности</h2><p>Например, с персональными данными часто нужно стирать даже логи.</p><p>Связка: вызов сервиса сервисом</p><p>Запрос — проверка периметра. Откуда может утечь? Через сервисы или через шины.</p><h2 id=сценарий-расследования-сбоя-на-endpoint>Сценарий: расследования сбоя на endpoint</h2><h2 id=сценарий-подграф-изолированного-тестирования>Сценарий: подграф изолированного тестирования</h2><p>Поднять изолированный подграф и его тестировать или нагружать.</p><p>Проблема: у почти любого сервиса подграф входит и выходит в монолит. А монолит тянет всю систему.</p><h2 id=поддержка-системы>Поддержка системы</h2><p>Как поддерживать и наполнять Persistent Fabric</p><ul><li>Каждый источник заполняет свою маленькую часть информации и связи между элементами.</li><li>Эта инфа загружается в базу, с сохранением истории</li></ul><p>Задачи in-progress</p><ul><li>Граф потоков данных через шины</li><li>Граф связей UI points — граф пользовательских траекторий на основе клиентского логирования.</li></ul></div><div class=pagination><a href=/conf/devrelconf/5/technical-authors/ class="left arrow">&#8592;</a>
<a href=/conf/knowledgeconf/19/voluntary-forced-knowledge-sharing/ class="right arrow">&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2021-09-16 10:16:32.330567414 &#43;0000 UTC m=&#43;0.124676854">2021</time> . Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>