<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Разгоняем обработку событий до 1.6М/сек. Опыт Badoo &middot; Конспекты</title><link rel=stylesheet href=/conf/css/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700"><link rel=stylesheet href=/conf/custom.css><link rel=icon type=image/png sizes=32x32 href=/conf/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/conf/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/conf/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=Конспекты><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107215405-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-107215405-3');</script></head><body><nav class=nav><div class=nav-container><a href=/conf/><h2 class=nav-title>Конспекты</h2></a><ul><li><a href=/conf/>Posts</a></li></ul></div></nav><main><div class=post><div class=single__header><div class=post-info>Александр Крашенинников, Badoo</div><h1 class=post-title>Разгоняем обработку событий до 1.6М/сек. Опыт Badoo</h1><div class=post-line></div><div class=tag-block><span class=catalogue-tags><a href=/conf/tags/highload class=tags>Highload</a></span><span class=catalogue-tags><a href=/conf/tags/2018 class=tags>2018</a></span><span class=catalogue-tags><a href=/conf/tags/badoo class=tags>Badoo</a></span></div></div><p>Темы доклада:</p><ul><li>Зачем собирать статистику</li><li>Как это делать</li><li>Как показывать и анализировать</li></ul><h1 id=зачем-собирать-статистику>Зачем собирать статистику</h1><ul><li>Мониторинг жизнеспособности проекта</li><li>давать ответы на вопросы бизнеса</li><li>хочешь улучшить — измерь</li></ul><h1 id=жизненный-цикл-статистики>Жизненный цикл статистики</h1><h2 id=1-define>1. Define</h2><p>Что собираем?</p><ul><li>Бизнес-метрики приложения</li><li>Полутехнические — инсталляции приложений, UX</li><li>Трекинг поведения пользователей</li></ul><h2 id=2-collect>2. Collect</h2><p>Статистика отсылается одновременно с бизнес-событием, но отдельным потоком.</p><p>Доставка событий</p><ul><li>конвейер обработки — внешняя система. Так лучше, потому что статистику создают микросервисы.</li><li>статистика отвязана от хранилищ для бизнес-логики</li><li>данные из контекста приложения переносим вовне</li></ul><p>Нужен транспорт. Выбираем его под задачу и мощности. Аспекты: гарантии доставки, биндинги для языков программирования, масштабируемость.</p><p>Варианты: РСУБД, Flume, Kafka, LSD.</p><p>В Badoo используют LSD — Live Streaming Daemon.</p><h2 id=3-process>3. Process</h2><p>Что хотим получить из данных?</p><ul><li>Построить графики с долгосрочной историей</li><li>выполнять ad-hoc запросы</li></ul><p>Как рисовать график?</p><ul><li>из сырых данных</li><li>из time series</li></ul><p>Будем использовать гибридный подход: от каждого свои преимущества. Хвост из сырых данных и долгосрочный timeseries.</p><p>Метрики росли, компания последовательно переходила по технологиям:</p><ul><li>MySQL</li><li>Sharding</li><li>Hadoop</li><li>Spark</li><li>ClickHouse</li></ul><h3 id=clickhouse>ClickHouse</h3><p>«Инструмент классный, документация ваще огонь, я сам туда писал».</p><p>Итоги фазы:</p><ul><li>Научились выбирать технологии под масштаб</li><li>Выбрали ClickHouse и пока не упёрлись в потолок</li></ul><h2 id=4-present>4. Present</h2><p>Доступ к данным</p><ul><li>Дашборды из time series</li><li>drop detection — самое необычное поведение пользователей</li><li>anomaly detection. Для каждой метрики вычисляем предсказание и threshold. Если потом метрика выходит за пределы, включаем alert.</li></ul><p>Результаты фазы Present:</p><ul><li>дашборды с графиками</li><li>ручной мониторинг метрик</li><li>автоматика Anomaly Detection</li></ul></div><div class=pagination><a href=/conf/knowledgeconf/19/biocad-knowledge-base-development/ class="left arrow">&#8592;</a>
<a href=/conf/devrelconf/5/ghostwriters/ class="right arrow">&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2021-09-16 10:27:56.643698454 &#43;0000 UTC m=&#43;0.179423073">2021</time> . Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>