<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Как доставить быстро и без боли. Автоматизируем релизы &middot; Конспекты</title><link rel=stylesheet href=/conf/css/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700"><link rel=stylesheet href=/conf/custom.css><link rel=icon type=image/png sizes=32x32 href=/conf/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/conf/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/conf/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=Конспекты><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107215405-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-107215405-3');</script></head><body><nav class=nav><div class=nav-container><a href=/conf/><h2 class=nav-title>Конспекты</h2></a><ul><li><a href=/conf/>Posts</a></li></ul></div></nav><main><div class=post><div class=single__header><div class=post-info>Александр Коротков, ЦИАН</div><h1 class=post-title>Как доставить быстро и без боли. Автоматизируем релизы</h1><div class=post-line></div><div class=tag-block><span class=catalogue-tags><a href=/conf/tags/devopsconf class=tags>DevOpsConf</a></span><span class=catalogue-tags><a href=/conf/tags/2019 class=tags>2019</a></span></div></div><h2 id=проблемы-в-циан>Проблемы в ЦИАН:</h2><ul><li>долгое и некачественное ревью</li><li>1 релиз в день, но хотелось ускориться</li><li>конфликты между задачами</li><li>длительное ожиданиие релиза</li><li>полный откат всего релиза при наличии проблем</li><li>в среднем задачи доставляются за 10 дней</li></ul><h2 id=оптимизация-code-review>Оптимизация Code Review</h2><h3 id=интеграция-с-системой-контроля-версий-и-трекером-задач>Интеграция с системой контроля версий и трекером задач</h3><p>Для этого делаем несколько операций по автоматизации после перевода задачи в статус: поиск затронутых репозиторий, блокировние ветки от изменений, мёрдж мастер-ветки в фича-ветку, разворачивание на тестовое-окружение и прогон тестов.</p><h3 id=ревьюеры>Ревьюеры</h3><p>Выбрали схему с 1 обязательным ревьюером, 1 ревьюером по выбору, а также 1 апрув от CI c проверками и тестами</p><h2 id=оптимизация-тестирования>Оптимизация тестирования</h2><p>Для задач, которые не требуют ручного тестирования, задача сразу переходит к статусу на деплой. Для прочих задач был добавлен дополнительный статус в флоу задач, который автоматически назначал свободного и подходящего тестировщика для этой задачи.</p><h2 id=оптимизация-тестовых-бета-стендов>Оптимизация тестовых (бета) стендов</h2><p>Было принято решение разбить один бета-стенд на несколько бета-стендов для каждой из команд, каждый из которых обновляется вместе с веткой master, сохраняя таким образом синхронизацию.</p><h2 id=оптимизация-деплоя>Оптимизация деплоя</h2><p>С помощью интеграции с трекером задач ищем блокирующие задачи, и закидываем задачу на деплой в специальную очередь, чтобы разные деплои не конкурировали друг с другом.</p><h2 id=мониторинг>Мониторинг</h2><p>В ЦИАН сложная архитектура роутинга запросов, поэтому запрос от пользователя идёт по одной схеме, а запросы между микросервисами по другой схеме. Поэтому прямой health check сложен и был выбран путь мониторинга: собираются системные метрики из prometheus, метрики приложения, пользовательские метрики из ELK. Для деплоя основной метрикой является количество 500 ошибок.</p><h2 id=канареечное-тестирование>Канареечное тестирование</h2><p>Разворачиваем небольшую часть и смотрим на метрики — если с метриками всё хорошо, то подтверждаем релиз и раскатываем весь релиз.</p><h2 id=что-вышло>Что вышло:</h2><ul><li>от 1 к 70 релизов в день</li><li>задача приходит в прод за два дня</li></ul></div><div class=pagination><a href=/conf/knowledgeconf/19/manager-analyst-km/ class="left arrow">&#8592;</a>
<a href=/conf/devrelconf/5/brand-ambassador/ class="right arrow">&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2021-09-16 15:13:52.980914088 &#43;0000 UTC m=&#43;0.130561333">2021</time> . Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>